---
import { type CollectionEntry, getCollection } from "astro:content";
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';

type Props = CollectionEntry<'newsroom'>['data'];

const { title, description, heroImage } = Astro.props.data.newsroom;
const relatedPosts = await getCollection("newsroom", ({ data }) => {
  return data.tags 
  	&& data.tags.some(item1 => Astro.props.data.newsroom.tags?.some(item2 => item1.toLowerCase() === item2.toLowerCase()))
	&& data.tinaInfo.path != Astro.props.data.newsroom.id;
});

---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} image={heroImage}/>
		<style>
			main {
				width: 100%;
				max-width: 100%;
				margin: 0;
			}
			.hero-image {
				width: 100%;
			}
			.hero-image img {
				display: block;
				margin: 0 auto;
				border-radius: 12px;
				box-shadow: var(--box-shadow);
			}
			.prose {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 1em;
				color: rgb(var(--gray-dark));
			}
			.title {
				margin-bottom: 1em;
				padding: 1em 0;
				text-align: center;
				line-height: 1;
			}
			.title h1 {
				margin: 0 0 0.5em 0;
			}
			.date {
				margin-bottom: 0.5em;
				color: rgb(var(--gray));
			}
			.last-updated-on {
				font-style: italic;
			}
		</style>
		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	</head>
	<body>
		<Header />
		<main>
			<slot />
			<hr style="margin: 0 20px 0 20px">
			<div class="container related-posts" style="grid-row-gap: 1.25rem;">
				<div class="related-post-title">Read more</div>
				<div class="related-post-grid">
					{relatedPosts.map(post => (
						<a class="d-flex flex-column text-dark gap-4" href={'/' + post.collection + '/' + post.id}>
							{post.data.heroImage && (
							<img 
							class="rounded bg-gray-400 dark:bg-slate-700 shadow-lg md:h-full w-full" 
							src={post.data.heroImage}
							height="225" 
							sizes="(max-width: 900px) 400px, 900px" 
							style="object-fit:cover;object-position:center;max-width:100%;max-height:100%" width="400">
							)}
							{post.data.pubDate && <div class="date-text"><FormattedDate className="date-text" date={post.data.pubDate} /></div>}
							{post.data.title && <h2 style="color: #343A40; font-size: 2rem; font-style: normal; font-weight: 500; line-height: 2.2rem; letter-spacing: -0.04rem;"  set:html={post.data.title} />}
							{post.data.description && <p style="color: #000; font-size: 0.9375rem;font-style: normal;font-weight: 400;line-height: 1.25rem;" set:html={post.data.description} />}
						</a>
					))}
				</div>
			</div>
			<hr>
		</main>
		<Footer />
	</body>
</html>
